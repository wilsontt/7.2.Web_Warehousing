# 規格文件 (SPEC): 1. 基本作業 - 代碼維護
**版本**: 1.1 (修訂版)
**狀態**: [草稿]
**負責人**: [IT 工程師 (您)]
**依據憲章**: v2.1.0

## 1. 模組概述 (Overview)
本模組負責管理系統中所有「分類代碼」。此功能取代舊系統的「代碼維護(WD00000)」。

本介面採用三欄式連動佈局（大分類 -> 中分類 -> 細分類）。**所有資料異動（新增、修改、刪除（或停用））必須在工具列按下「儲存」按鈕後，才批次生效。**

## 2. 功能清單與使用者故事 (Features & User Stories)

### 2.1 UI 佈局：三欄式連動介面
**使用者故事 (User Story)**:
- **身為** [系統管理員]
- **我想要** [在一個畫面上同時看到「大分類」、「中分類」和「細分類」的列表]
- **以便** [我能快速瀏覽、查詢、新增、修改、刪除（或停用）三層之間的關聯性]

**驗收條件 (Acceptance Criteria) - [憲章 P3, P8]**:
- [ ] **(UI 規範)** 介面**必須**採用三欄佈局，類似 `設計規範v2.0.md` 的 Master-Detail 概念，但擴展為三欄。
- [ ] **(UI 規範)** 介面**必須**遵循 `設計規範v2.0.md` 的 A/B 區框架，本功能位於 B 區。
- [ ] **(UI 規範 - 已修改)** B 區頂部工具列 (B2-1) 需提供「新增大分類」、「新增中分類」、「新增細分類」、「刪除」、「查詢」、「列印」，以及 **「儲存」** 和 **「取消」** 按鈕。
- [ ] **(UI 規範)** 每個欄位的列表均需符合「隔行變色」 和「選取高亮」 規範。
- [ ] **(UI 規範)** 欄位內的內容如果太長，**不得**自動折行 (whitespace-nowrap)。
- [ ] **(UI 規範 - 新增)** 當頁面有未儲存的變更時，「儲存」和「取消」按鈕**必須**高亮 (Enable)，「儲存」按鈕可設為主要按鈕 (Primary Button)。

### 2.2 互動邏輯：資料連動
**使用者故事 (User Story)**:
- **身為** [系統管理員]
- **我想要** [當我點擊左側的「大分類」時，右上方（中分類）和右下方（細分類）的列表會自動過濾]
- **以便** [我能專注於維護當前大分類下的子項目]

**驗收條件 (Acceptance Criteria) - [憲章 P3]**:
- [ ] **(連動 1)** 左側「大分類 (CDF)」 列表（`majorCatList`）為本頁面的進入點。
- [ ] **(連動 2)** 當使用者點擊「大分類」列表中的任一項目（例如 `majorCatNo: "102"`）：
    - 右上方「中分類 (CDS)」 列表（`midCatList`）**必須**自動過濾，僅顯示 `majorCatNo` 為 "102" 的資料。
    - 右下方「細分類 (CDT)」 列表（`subCatList`）**必須**被清空，或顯示「請先選擇中分類」。
- [ ] **(連動 3)** 當使用者接著點擊右上方「中分類」列表中的任一項目（例如 `midCatCode: "005"`）：
    - 右下方「細分類 (CDT)」 列表（`subCatList`）**必須**自動過濾，僅顯示 `majorCatNo` 為 "102" **且** `midCatCode` 為 "005" 的資料。
- [ ] **(狀態)** **必須**清楚高亮顯示目前被選中的「大分類」和「中分類」項目。
- [ ] **(狀態 - 新增)** 當使用者點擊「大分類」或「中分類」時，若當前有未儲存的變更，**必須**彈窗提示：「您有未儲存的變更，是否要放棄？」，使用者確認放棄後才可切換。

### 2.3 功能：資料維護 (CRUD)
**使用者故事 (User Story)**:
- **身為** [系統管理員]
- **我想要** [在每個分類列表中進行新增、修改、刪除，並在完成所有操作後，點擊「儲存」一次提交]
- **以便** [我能確保所有相關變更被一次性處理，並有機會在儲存前「取消」]

**驗收條件 (Acceptance Criteria) - [憲章 P2, P3, P8.3]**:
- [ ] **(新增)** 點擊「新增大分類」時，`majorCatList` 應在**前端**新增一筆空白資料列，並標記為「待新增」狀態。
- [ ] **(新增)** 點擊「新增中分類」時，**必須**檢查是否已選定一筆「大分類」。若已選定，`midCatList` 應新增一筆空白資料列，其 `majorCatNo` 自動代入所選項目。
- [ ] **(新增)** 「新增細分類」邏輯同上，**必須**檢查是否已選定「中分類」。
- [ ] **(修改)** 使用者應可**直接在列表的儲存格 (Cell) 中**修改資料。被修改的資料列應在**前端**標記為「待修改」狀態。
- [ ] **(修改)** `majorCatNo`, `midCatCode`, `subcatCode` 這些「鍵值」欄位在建立後**不允許**被修改。
- [ ] **(刪除)** 點擊「刪除」按鈕時，**必須**彈窗二次確認。確認後，該資料列應在**前端**標記為「待刪除」狀態（例如顯示刪除線）。
- [ ] **(儲存 - 核心)** 當使用者按下「儲存」按鈕時，系統**必須**收集所有被標記為「待新增」、「待修改」、「待刪除」的資料，**打包成一個批次請求 (Batch Request)**，統一提交至後端 API。
- [ ] **(儲存 - 核心)** 後端 API **必須**在一個資料庫「交易 (Transaction)」中處理此批次請求。
- [ ] **(儲存 - 回饋)** 儲存成功後，前端列表應刷新，移除「待處理」狀態。
- [ ] **(取消)** 當使用者按下「取消」按鈕時，**必須**彈窗二次確認：「您確定要放棄所有未儲存的變更嗎？」。
- [ ] **(取消)** 確認後，前端**必須**重新從後端載入資料，丟棄所有本地的（前端的）變更。
- [ ] **(驗證)** 所有 `...No` 和 `...Code` 欄位 皆為必填。
- [ ] **(驗證)** `CDF00 / majorCatNo` **必須**在 `CDF` 表中唯一 (Unique)。
- [ ] **(防呆)** **必須**有後端防呆機制：如果一個「大分類」底下仍有「中分類」，則**禁止**刪除該「大分類」。

## 3. 非功能性需求 (Non-Functional Requirements)
-