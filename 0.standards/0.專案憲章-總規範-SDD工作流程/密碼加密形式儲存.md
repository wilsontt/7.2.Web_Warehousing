## SMTP 密碼存放位置
### 1. 資料庫位置
SMTP 密碼存放在 SQLite 資料庫中：
- 資料庫檔案：backend/data/aetim.db
- 資料表名稱：email_configurations
- 欄位名稱：password
### 2. 儲存格式
密碼以加密形式儲存：
- 加密演算法：AES-256-GCM
- 儲存格式：base64 字串（格式：iv:authTag:ciphertext）
- 加密金鑰：從環境變數 ENCRYPTION_KEY 讀取
### 3. 加密流程
當您在前端設定 SMTP 密碼時：
1. 前端傳送明文密碼到後端 API
2. 後端接收到密碼後，在 EmailConfiguration.upsert() 方法中自動加密
3. 使用 encrypt() 函數（backend/src/utils/encryption.ts）加密
4. 加密後的密碼儲存到資料庫的 email_configurations.password 欄位
### 4. 解密流程
當需要使用密碼發送郵件時：
1. 從資料庫讀取加密的密碼
2. 使用 decrypt() 函數解密
3. 使用解密後的明文密碼建立 nodemailer transporter
### 5. 安全特性
- 資料庫中的密碼欄位儲存的是加密後的內容，不是明文
- API 回應不會返回密碼欄位（EmailConfiguration.findActive() 返回空字串）
- 只有內部服務需要時才會解密（如 EmailConfigService.getConfigurationWithPassword()）
- 符合 ISO 27001 規範
### 6. 如何查看（僅供管理用途）
如果您需要查看資料庫中的加密密碼（不建議直接查看）：
```
# 在正式環境伺服器上
cd ~/aetim
docker-compose -f docker/docker-compose.prod.yml exec backend sqlite3 /app/data/aetim.db "SELECT id, host, username, password FROM email_configurations;"
```
`**注意：**`
`password` 欄位顯示的是加密後的內容，格式類似：base64_iv:base64_authTag:base64_ciphertext
總結：SMTP 密碼以 `**AES-256-GCM 加密後**`，
儲存在 backend/data/aetim.db 的 email_configurations 表的 password 欄位中。