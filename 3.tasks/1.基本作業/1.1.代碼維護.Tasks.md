# 任務清單 (TASKS): 1.1 代碼維護 (Code Maintenance)

**文件版本**: v1.0.0
**狀態**: 執行中 (In Progress)
**負責人**: AI 專案顧問
**依據計畫**: `2.plans/1.基本作業/1.1.代碼維護.plan.md` (v1.0.0)
**最後更新**: 2026-01-01

---

## 1. 基礎建設 (Infrastructure)

- [ ] **T-1-1-1**: 定義 TypeScript Interfaces & Types
    - **目標**: 建立前後端溝通的資料型別合約。
    - **檔案**: `frontend/src/types/codeMaintenance.ts`
    - **內容**: 定義 `MajorCategory`, `MidCategory`, `SubCategory`, `BatchSaveRequest` 介面，確保欄位名稱符合 Lovable 規範。
    - **驗收**: 所有的 Interface 必須包含 JSDoc 註解說明。

- [ ] **T-1-1-2**: 建立 Mock Service
    - **目標**: 隔離後端依賴，提供前端開發所需的假資料與模擬延遲。
    - **檔案**: `frontend/src/services/codeMaintenanceService.ts`
    - **內容**: 
        - 實作 `getAllCoordinates()`: 回傳預設的 Mock Data。
        - 實作 `saveBatch()`: 模擬 `Promise` 延遲與 Console Log 輸出 Payload。
    - **驗收**: 呼叫 Service 能正確取得資料，並在 Console 看到模擬的 API 回應。

## 2. UI 元件開發 (UI Implementation)

- [x] **T-1-1-3**: 建立頁面骨架與路由
    - **目標**: 建立功能入口與基本版型配置。
    - **檔案**: 
        - `frontend/src/pages/basic/CodeMaintenancePage.tsx`
        - `frontend/src/App.tsx` (路由設定)
        - `frontend/src/components/layout/Header.tsx` (新增選單連結)
    - **內容**:
        - 設定路由 `/basic/code-maintenance`。
        - 使用 `ResizableLayout` 實作左 25% / 右 75% 佈局。
        - 實作右側 Nested Grid (上 35% / 下 65%)。
        - 建立頂部 Toolbar (包含新增、儲存、取消按鈕)。
    - **驗收**: 進入頁面可看到正確的三區塊佈局，且 RWD 行為正常。

- [ ] **T-1-1-4**: 實作大分類列表 (MajorCategoryList)
    - **目標**: 實作左側大分類列表。
    - **檔案**: `frontend/src/components/basic/MajorCategoryList.tsx`
    - **內容**:
        - 使用 `DataTable` 樣式規範 (Hover, Selected)。
        - 實作單選功能 (`onSelect`)。
        - 顯示欄位：大分類編碼、大分類名稱。
    - **驗收**: 點擊項目可觸發 `onSelect` 事件，且選取項目呈現高亮狀態。

- [ ] **T-1-1-5**: 實作中/細分類列表 (Mid/Sub CategoryList)
    - **目標**: 實作右側連動列表。
    - **檔案**: 
        - `frontend/src/components/basic/MidCategoryList.tsx`
        - `frontend/src/components/basic/SubCategoryList.tsx`
    - **內容**:
        - 實作列表顯示邏輯。
        - 實作 Empty State (當父層未選取時顯示提示)。
        - 實作數值欄位格式化 (千分位, 2位小數)。
    - **驗收**: 選擇大分類後，中分類列表應正確刷新；未選時應顯示提示訊息。

## 3. 邏輯實作 (Logic Implementation)

- [ ] **T-1-1-6**: 實作 CRUD 狀態管理與校驗
    - **目標**: 處理資料的新增、修改、刪除狀態與前端防呆驗證。
    - **檔案**: `frontend/src/pages/basic/CodeMaintenancePage.tsx`
    - **內容**:
        - 實作 `isNew`, `isDirty`, `isDeleted` 狀態追蹤。
        - 實作新增邏輯：自動帶入 Parent ID。
        - 實作刪除驗證：刪除父層前檢查是否有子層資料。
        - 實作主鍵保護：修改模式下主鍵欄位唯讀。
    - **驗收**: 新增資料後「儲存」按鈕應亮起；嘗試刪除有子層的父層應彈出警告。

- [ ] **T-1-1-7**: 整合批次儲存 (Explicit Save)
    - **目標**: 將變更轉換為 Batch Request 格式並送出。
    - **檔案**: `frontend/src/pages/basic/CodeMaintenancePage.tsx`
    - **內容**:
        - 收集所有 `changes` (inserts, updates, deletes)。
        - 呼叫 Service `saveBatch()`。
        - 處理 Loading 狀態與成功/失敗提示 (Toast)。
    - **驗收**: 點擊儲存後，Console 應顯示正確的 JSON Payload，且介面回復為 Clean 狀態。

---

## 4. 驗收 (Review)

- [ ] **T-1-1-8**: 執行 UI 驗收測試
    - **目標**: 確保符合所有驗收條件與規範。
    - **參考**: `1.specs/1.基本作業/1.1.代碼維護.spec.md` 之 Ch.7 驗收標準。
    - **內容**: 逐項執行 UI 測試並記錄結果。
